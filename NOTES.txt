TEST STRATEGY & RATIONALE: KRAKEN V2 MIGRATION

1. VALIDATION FOCUS & RISK MITIGATION
   - Schema Stability: Kraken V2 responses use structured objects. Tests validate
     critical fields (e.g., bid, ask, symbol, timestamp) to detect breaking changes.
   - Connection Liveness: Heartbeats and status messages are validated to ensure
     the gateway maintains idle connections and does not silently drop sessions.
   - Subscription Integrity: Tests verify that subscriptions, unsubscriptions,
     and acknowledgments behave deterministically and do not leak data streams.

2. KEY ASSUMPTIONS
   - Market Activity: Tests assume sufficient liquidity for BTC/USD and ETH/USD
     to generate ticker, trade, and book updates within test timeouts.
   - Network Environment: Tests assume stable WSS connectivity without aggressive
     proxies, firewalls, or connection timeouts interfering with WebSocket streams.
   - API Contract Stability: Core channel formats and acknowledgment structures
     are assumed to remain backward-compatible within the V2 release window.

3. DESIGN TRADE-OFFS
   - Predicate-Based Waiting: Custom condition-based waits (e.g., m.channel === 'ticker')
     were chosen over fixed sleeps to reduce flakiness and improve execution speed.
   - Timeout Tuning: Timeouts were calibrated per channel (3s–20s) to balance
     reliability against test suite runtime and false positives.
   - Isolated Connections: Each test uses a fresh WebSocket connection to ensure
     isolation, prevent cross-test contamination, and simplify debugging.
   - Silence Validation: Explicit "no-message" windows are used to validate unsubscribe
     and idle-connection behavior rather than assuming silence by default.

4. LANGUAGE & TOOLING RATIONALE: TYPESCRIPT + PLAYWRIGHT

   TypeScript with Playwright was selected over Python due to:

   A. EVENT-DRIVEN CONCURRENCY
      WebSocket testing requires listening and sending concurrently. Node.js’s
      event loop model aligns naturally with this pattern and reduces async
      complexity compared to Python’s asyncio orchestration.

   B. TYPE SAFETY FOR FINANCIAL DATA
      Kraken V2 emits deeply nested financial objects. TypeScript’s static typing
      allows compile-time detection of schema changes (e.g., missing bid/ask),
      preventing silent runtime failures common in dynamically typed languages.

   C. TEST RUNNER MATURITY & CI SUPPORT
      Playwright’s TypeScript runner offers robust retries, tracing, HTML reports,
      and parallel execution, making it well-suited for regression-grade financial
      API testing and CI pipelines.

5. VERSION CONTROL & MAINTENANCE PRACTICES
   - Repository Structure: Test helpers, constants, and specs are modularized to
     support future channel additions with minimal duplication.
   - Branching Strategy: Main branch contains stable regression tests; feature
     branches isolate new channel or scenario coverage.
   - Commit Discipline: Atomic commits separate logic changes from configuration
     updates, enabling clean rollbacks and traceability.
